{% extends "base.html" %}

{% block content %}
<div style="text-align: center; margin-bottom: 2rem;">
    <h1>Hello, {{ user_name }}! ðŸ‘‹</h1>
    <p class="text-muted">What are we cooking today?</p>

    <div style="margin: 1rem 0;">
        <a href="{{ url_for('add_recipe') }}" class="btn-secondary"
            style="text-decoration: none; padding: 10px 20px; border-radius: 20px; background: rgba(6, 182, 212, 0.2); color: var(--secondary); border: 1px solid var(--secondary);">
            <i class="fas fa-plus"></i> Create Manual Recipe
        </a>
    </div>
</div>

<div class="card" style="max-width: 800px; margin: 0 auto;">
    <form action="{{ url_for('upload_file') }}" method="POST" enctype="multipart/form-data" id="uploadForm">
        <div class="upload-area" id="dropArea">
            <i class="fas fa-cloud-upload-alt"
                style="font-size: 3rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
            <h3>Drag & Drop or Click to Upload</h3>
            <p class="text-muted">Supports JPG, PNG</p>
            <input type="file" name="file" id="fileInput" accept="image/*" style="display: none;" required>
            <img id="imagePreview" alt="Image Preview">
        </div>

        <div style="margin-top: 2rem; text-align: center;">
            <button type="submit" class="btn-primary" id="analyzeBtn" style="max-width: 300px; display: none;">
                <i class="fas fa-magic"></i> Analyze & Generate Recipe
            </button>
            <div id="loading" style="display: none; margin-top: 1rem;">
                <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--secondary-color);"></i>
                <p style="margin-top: 0.5rem;">Analyzing food image... This usually takes ~10 seconds.</p>
            </div>
        </div>
    </form>
</div>

<!-- Quick Links -->
<div class="feature-grid">
    <a href="{{ url_for('history') }}" class="card" style="text-decoration: none; color: inherit; text-align: center;">
        <i class="fas fa-history" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
        <h3>Recipe History</h3>
    </a>
    <a href="{{ url_for('favorites') }}" class="card"
        style="text-decoration: none; color: inherit; text-align: center;">
        <i class="fas fa-heart" style="font-size: 2rem; color: var(--secondary-color); margin-bottom: 1rem;"></i>
        <h3>My Favorites</h3>
    </a>
</div>

<script>
    const dropArea = document.getElementById('dropArea');
    const fileInput = document.getElementById('fileInput');
    const imagePreview = document.getElementById('imagePreview');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const uploadForm = document.getElementById('uploadForm');
    const loading = document.getElementById('loading');

    dropArea.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', function () {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                analyzeBtn.style.display = 'inline-block';
            }
            reader.readAsDataURL(file);
        }
    });

    uploadForm.addEventListener('submit', function () {
        analyzeBtn.style.display = 'none';
        loading.style.display = 'block';
    });
</script>
{% endblock %}